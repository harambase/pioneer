/*
SQLyog 企业版 - MySQL GUI v8.14 
MySQL - 5.7.17 : Database - harambase
*********************************************************************
*/

/*!40101 SET NAMES utf8 */;

/*!40101 SET SQL_MODE=''*/;

/*!40014 SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0 */;
/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;
/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */;
/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */;
CREATE DATABASE /*!32312 IF NOT EXISTS*/`harambase` /*!40100 DEFAULT CHARACTER SET latin1 */;

USE `harambase`;

/*Table structure for table `harambase_admin` */

DROP TABLE IF EXISTS `harambase_admin`;

CREATE TABLE `harambase_admin` (
  `USERID` int(11) NOT NULL,
  `UNAME` varchar(10) DEFAULT NULL,
  `EMAIL` varchar(20) DEFAULT NULL,
  `FNAME` varchar(15) DEFAULT NULL,
  `LNAME` varchar(15) DEFAULT NULL,
  `PASSWORD` varchar(16) DEFAULT NULL,
  `CREATORID` int(11) DEFAULT NULL,
  PRIMARY KEY (`USERID`),
  UNIQUE KEY `UNAME` (`UNAME`),
  KEY `CREATORID` (`CREATORID`),
  CONSTRAINT `harambase_admin_ibfk_1` FOREIGN KEY (`CREATORID`) REFERENCES `harambase_admin` (`USERID`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=latin1;

/*Data for the table `harambase_admin` */

LOCK TABLES `harambase_admin` WRITE;

insert  into `harambase_admin`(`USERID`,`UNAME`,`EMAIL`,`FNAME`,`LNAME`,`PASSWORD`,`CREATORID`) values (0,'admin','admin@harambase.org','ad','min','admin',NULL);

UNLOCK TABLES;

/*Table structure for table `harambase_bid` */

DROP TABLE IF EXISTS `harambase_bid`;

CREATE TABLE `harambase_bid` (
  `USERID` int(11) NOT NULL,
  `ITEMID` int(11) NOT NULL,
  `BIDDINGTIME` timestamp(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3) ON UPDATE CURRENT_TIMESTAMP(3),
  `MAXBIDLIMIT` double DEFAULT NULL,
  PRIMARY KEY (`USERID`,`ITEMID`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;

/*Data for the table `harambase_bid` */

LOCK TABLES `harambase_bid` WRITE;

insert  into `harambase_bid`(`USERID`,`ITEMID`,`BIDDINGTIME`,`MAXBIDLIMIT`) values (1,103,'2017-07-01 00:00:00.000',10),(2,100,'2017-06-29 11:16:28.509',50),(2,101,'2017-06-28 10:00:00.000',150),(2,103,'2017-07-02 00:00:01.000',10),(3,100,'2017-06-28 00:00:00.000',60),(3,101,'2017-06-30 11:00:00.000',160),(3,102,'2017-07-01 11:00:00.000',6),(3,109,'2017-07-06 18:01:44.665',170),(4,101,'2017-06-30 00:00:00.000',170),(4,102,'2017-06-30 00:00:00.000',7),(4,104,'2017-06-29 00:00:00.000',50),(6,105,'2017-07-06 16:50:36.641',50),(7,105,'2017-07-06 17:47:41.335',52);

UNLOCK TABLES;

/*Table structure for table `harambase_feedback` */

DROP TABLE IF EXISTS `harambase_feedback`;

CREATE TABLE `harambase_feedback` (
  `ITEMID` int(11) unsigned NOT NULL,
  `OVERALLRATING` double DEFAULT NULL,
  `ITEMQUALITY` double DEFAULT NULL,
  `DELIVERY` double DEFAULT NULL,
  `COMMENTS` varchar(300) DEFAULT NULL,
  PRIMARY KEY (`ITEMID`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;

/*Data for the table `harambase_feedback` */

LOCK TABLES `harambase_feedback` WRITE;

insert  into `harambase_feedback`(`ITEMID`,`OVERALLRATING`,`ITEMQUALITY`,`DELIVERY`,`COMMENTS`) values (100,9.5,3,1,'The hat did not arrive at all, I recieved a notifcation of shipping from the seller. But got nothing.'),(101,8,5,4,'The BOOK IS GOOD.'),(102,10,5,4,'The BOOK IS GOOD.'),(104,5,5,4,'The NOODLE IS GOOD.');

UNLOCK TABLES;

/*Table structure for table `harambase_item` */

DROP TABLE IF EXISTS `harambase_item`;

CREATE TABLE `harambase_item` (
  `ITEMID` int(11) unsigned NOT NULL,
  `ITEMNAME` varchar(150) DEFAULT NULL,
  `ITEMCATEGORY` varchar(50) DEFAULT NULL,
  `STARTPRICE` double DEFAULT NULL,
  `DESCRIPTION` varchar(300) DEFAULT NULL,
  `SELLERID` int(11) DEFAULT NULL,
  `AUCTIONSTARTTIME` timestamp(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3) ON UPDATE CURRENT_TIMESTAMP(3),
  `AUCTIONENDTIME` timestamp(3) NOT NULL DEFAULT '0000-00-00 00:00:00.000',
  PRIMARY KEY (`ITEMID`),
  KEY `SELLERID` (`SELLERID`),
  CONSTRAINT `harambase_item_ibfk_1` FOREIGN KEY (`SELLERID`) REFERENCES `harambase_member` (`USERID`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=latin1;

/*Data for the table `harambase_item` */

LOCK TABLES `harambase_item` WRITE;

insert  into `harambase_item`(`ITEMID`,`ITEMNAME`,`ITEMCATEGORY`,`STARTPRICE`,`DESCRIPTION`,`SELLERID`,`AUCTIONSTARTTIME`,`AUCTIONENDTIME`) values (100,'SJU Snapback Hat','Outdoor Gear',30,'For the Johnniest of Johnnies!',1,'2017-06-28 11:00:00.000','2017-06-30 00:00:00.000'),(101,'DATABASES BOOK','BOOK',100,'BRAND NEW',3,'2017-06-27 11:00:00.000','2017-06-30 00:00:00.000'),(102,'CHINSES INSTANT NODDLES','FOOD',20,'COOK IN 5 MINS',2,'2017-06-27 11:00:00.000','2017-06-30 00:00:00.000'),(103,'TACO','FOOD',5,'FRESH',3,'2016-06-30 00:00:00.000','2018-06-30 00:00:00.000'),(104,'Abstarct Mathematics','BOOK',20,'BRAND NEW',3,'2017-06-02 09:46:37.528','2017-07-01 00:00:00.000'),(105,'INTRODUCTION TO Mathematics','BOOK',40,'BRAND NEW',3,'2017-06-28 11:00:00.000','2017-07-30 00:00:00.000'),(106,'INTRODUCTION TO Mathematics','BOOK',50,'BRAND NEW',3,'2017-06-28 11:00:00.000','2017-07-30 00:00:00.000'),(107,'Mathematics','BOOK',50,'BRAND NEW',3,'2017-07-28 11:00:00.000','2017-07-30 00:00:00.000'),(108,'TESTING','BOOK',50,'BRAND NEW',3,'2017-07-10 00:00:00.000','2017-08-01 00:00:00.000'),(109,'WangMonitor','Monitor',150,'Brand New',7,'2017-07-06 18:00:00.000','2017-08-01 00:00:00.000');

UNLOCK TABLES;

/*Table structure for table `harambase_member` */

DROP TABLE IF EXISTS `harambase_member`;

CREATE TABLE `harambase_member` (
  `USERID` int(10) NOT NULL,
  `UNAME` varchar(100) DEFAULT NULL,
  `EMAIL` varchar(100) DEFAULT NULL,
  `FNAME` varchar(50) DEFAULT NULL,
  `LNAME` varchar(50) DEFAULT NULL,
  `PASSWORD` varchar(50) DEFAULT NULL,
  `CREATORID` int(50) DEFAULT NULL,
  `ISBUYER` int(50) DEFAULT NULL,
  `ISELLER` int(50) DEFAULT NULL,
  PRIMARY KEY (`USERID`),
  UNIQUE KEY `UNAME` (`UNAME`),
  KEY `CREATORID` (`CREATORID`),
  CONSTRAINT `harambase_member_ibfk_1` FOREIGN KEY (`CREATORID`) REFERENCES `harambase_admin` (`USERID`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=latin1;

/*Data for the table `harambase_member` */

LOCK TABLES `harambase_member` WRITE;

insert  into `harambase_member`(`USERID`,`UNAME`,`EMAIL`,`FNAME`,`LNAME`,`PASSWORD`,`CREATORID`,`ISBUYER`,`ISELLER`) values (1,'jfolks','jfolks@harambase.org','Josh','Folkerds','Folkerds',0,1,1),(2,'mkounn','mkounn@harambase.org','Matthew','Kounniyom','Kounniyom',0,1,1),(3,'s1lin','slin@harambase.org','Shilei','Lin','Shilei',0,1,1),(4,'irahal','irahal@harambase.org','Imad','Rahal','Rahal',0,1,1),(5,'hrambe','hrambe@harambase.org','Harambe','Gorilla','Gorilla',0,0,0),(6,'lmatt','Matt@harambase.org','Matthew','Lynch','Lynch',0,1,1),(7,'Wangwei','wang@harambase.org','WANG','Wei','Wei',0,1,1);

UNLOCK TABLES;

/* Trigger structure for table `harambase_item` */

DELIMITER $$

/*!50003 DROP TRIGGER*//*!50032 IF EXISTS */ /*!50003 `ADD_ITEM_TRIG` */$$

/*!50003 CREATE */ /*!50017 DEFINER = 'root'@'%' */ /*!50003 TRIGGER `ADD_ITEM_TRIG` BEFORE INSERT ON `harambase_item` FOR EACH ROW BEGIN
       DECLARE N INT;
       SELECT MAX(ITEMID) INTO N FROM `harambase_item`;
       SET N = N + 1;
       SET NEW.ITEMID = N;
    END */$$


DELIMITER ;

/* Trigger structure for table `harambase_member` */

DELIMITER $$

/*!50003 DROP TRIGGER*//*!50032 IF EXISTS */ /*!50003 `ADD_MEMBER_TRIG` */$$

/*!50003 CREATE */ /*!50017 DEFINER = 'root'@'%' */ /*!50003 TRIGGER `ADD_MEMBER_TRIG` BEFORE INSERT ON `harambase_member` FOR EACH ROW BEGIN
       declare N int;
       select max(USERID) into N from `harambase_member`;
       set N = N + 1;
       set NEW.USERID = N;
    END */$$


DELIMITER ;

/* Function  structure for function  `ADMIN_LOG_IN_FUNC` */

/*!50003 DROP FUNCTION IF EXISTS `ADMIN_LOG_IN_FUNC` */;
DELIMITER $$

/*!50003 CREATE DEFINER=`root`@`%` FUNCTION `ADMIN_LOG_IN_FUNC`(USERNAME VARCHAR(10), USERPASSWORD VARCHAR(10)) RETURNS int(11)
BEGIN
	DECLARE ISLOG INT DEFAULT 0;
	SELECT COUNT(*) INTO ISLOG FROM HARAMBASE_ADMIN A WHERE A.UNAME = USERNAME AND A.PASSWORD = USERPASSWORD;
	RETURN ISLOG;
    END */$$
DELIMITER ;

/* Function  structure for function  `GETPRICE_FUNC` */

/*!50003 DROP FUNCTION IF EXISTS `GETPRICE_FUNC` */;
DELIMITER $$

/*!50003 CREATE DEFINER=`root`@`%` FUNCTION `GETPRICE_FUNC`(iID INTEGER) RETURNS int(11)
BEGIN
	DECLARE PRICE   INT DEFAULT 0;
	DECLARE NUMROWS INT DEFAULT 0;
	
	SELECT COUNT(*) INTO NUMROWS FROM HARAMBASE_BID B WHERE B.ITEMID = iID;
	
	IF NUMROWS=0 THEN
		RETURN 0;
	ELSEIF NUMROWS = 1 THEN
		SELECT I.STARTPRICE + 1 INTO PRICE FROM HARAMBASE_ITEM I WHERE I.ITEMID = iID;
	ELSE
		SELECT B.MAXBIDLIMIT + 1 INTO PRICE FROM HARAMBASE_BID B WHERE B.ITEMID = iID LIMIT 1;
	END IF;
	
	RETURN PRICE;
	
    END */$$
DELIMITER ;

/* Function  structure for function  `GETSTATUS_FUNC` */

/*!50003 DROP FUNCTION IF EXISTS `GETSTATUS_FUNC` */;
DELIMITER $$

/*!50003 CREATE DEFINER=`root`@`%` FUNCTION `GETSTATUS_FUNC`(iID INTEGER) RETURNS int(11)
BEGIN
	DECLARE ITEMSTATUS INT DEFAULT 0;
	DECLARE ENDTIME   TIMESTAMP DEFAULT STR_TO_DATE('1970-01-01 12:00:00','%Y-%m-%d %h:%i:%s');
	DECLARE STARTTIME TIMESTAMP DEFAULT STR_TO_DATE('1970-01-01 11:00:00','%Y-%m-%d %h:%i:%s');
	
	
	SELECT I.AUCTIONENDTIME   INTO ENDTIME   FROM HARAMBASE_ITEM I WHERE I.ITEMID = iID;
        SELECT I.AUCTIONSTARTTIME INTO STARTTIME FROM HARAMBASE_ITEM I WHERE I.ITEMID = iID;
        
	IF UNIX_TIMESTAMP(CURRENT_TIMESTAMP) > UNIX_TIMESTAMP(ENDTIME) THEN
		SET ITEMSTATUS = 1; /*SOLD*/
	ELSE
		SET ITEMSTATUS = 0; /*ON AUCTION*/
	END IF;
	
	IF UNIX_TIMESTAMP(CURRENT_TIMESTAMP) < UNIX_TIMESTAMP(STARTTIME) THEN
		SET ITEMSTATUS = -1; /*NOT ON AUCTION*/
	END IF;
        RETURN ITEMSTATUS;
    END */$$
DELIMITER ;

/* Function  structure for function  `GETWINNER_FUNC` */

/*!50003 DROP FUNCTION IF EXISTS `GETWINNER_FUNC` */;
DELIMITER $$

/*!50003 CREATE DEFINER=`root`@`%` FUNCTION `GETWINNER_FUNC`(iID INTEGER) RETURNS int(11)
BEGIN
	DECLARE WINNER INT DEFAULT 0;
	DECLARE NUMMAX INT DEFAULT 0;
	
	Select count(USERID) Into NUMMAX From HARAMBASE_BID 
        Where MAXBIDLIMIT = (SELECT Max(X.MAXBIDLIMIT) 
                             FROM HARAMBASE_BID X 
                             WHERE X.ITEMID = iID) AND ITEMID = iID;
                             
        IF (NUMMAX > 1) THEN        
		Select B.USERID Into WINNER From HARAMBASE_BID B
		Where  B.MAXBIDLIMIT = (SELECT Max(X.MAXBIDLIMIT) 
				       FROM HARAMBASE_BID X 
				       WHERE X.ITEMID = iID) 
		       AND ITEMID = iID         
		       AND B.BIDDINGTIME < (SELECT Y.BIDDINGTIME
					    FROM   HARAMBASE_BID Y
					    WHERE  Y.MAXBIDLIMIT = MAXBIDLIMIT 
					    AND Y.USERID <> B.USERID 
					    AND Y.ITEMID = iID);
        ELSEIF(NUMMAX = 0) THEN
          SET WINNER = 0;
          
        ELSE /*NUMMAX = 1*/
          Select USERID Into WINNER From HARAMBASE_BID 
          Where MAXBIDLIMIT = (SELECT Max(X.MAXBIDLIMIT) 
                               FROM HARAMBASE_BID X 
                               WHERE X.ITEMID = iID) AND ITEMID = iID;
        End If;
        
        Return WINNER;
        
    END */$$
DELIMITER ;

/* Function  structure for function  `MEMBER_LOG_IN_FUNC` */

/*!50003 DROP FUNCTION IF EXISTS `MEMBER_LOG_IN_FUNC` */;
DELIMITER $$

/*!50003 CREATE DEFINER=`root`@`%` FUNCTION `MEMBER_LOG_IN_FUNC`(USERNAME VARCHAR(10), USERPASSWORD VARCHAR(10)) RETURNS int(11)
BEGIN
	DECLARE ISLOG INT DEFAULT 0;
	SELECT COUNT(*) INTO ISLOG FROM HARAMBASE_MEMBER M WHERE M.UNAME = USERNAME AND M.PASSWORD = USERPASSWORD;
	RETURN ISLOG;
    END */$$
DELIMITER ;

/* Procedure structure for procedure `SEARCH_ITEM_PRO` */

/*!50003 DROP PROCEDURE IF EXISTS  `SEARCH_ITEM_PRO` */;

DELIMITER $$

/*!50003 CREATE DEFINER=`root`@`%` PROCEDURE `SEARCH_ITEM_PRO`(
	IN TID INT, 
	IN KEYWORD VARCHAR(225),
	IN TCATEGORY VARCHAR(225),  
	IN TAUCTIONSTARTTIME  TIMESTAMP, 
	IN TAUCTIONENDTIME  TIMESTAMP,
	IN CURBIDMIN  DOUBLE,
	IN CURBIDMAX  double
)
BEGIN
  IF TID IS NOT NULL THEN
          SELECT HI.ITEMID, HI.ITEMNAME, HI.ITEMCATEGORY, HI.AUCTIONSTARTTIME, HI.AUCTIONENDTIME, GETPRICE_FUNC(HI.ITEMID) AS CURRENTBID, GETSTATUS_FUNC(HI.ITEMID) AS STATUS
          FROM HARAMBASE_ITEM HI
          WHERE HI.ITEMID = TID;
          
  ELSe IF KEYWORD IS NOT NULL 
        AND TCATEGORY IS NOT NULL
        AND CURBIDMIN IS NOT NULL
        AND CURBIDMAX IS NOT NULL
        AND TAUCTIONSTARTTIME IS NOT NULL
        AND TAUCTIONENDTIME IS NOT NULL THEN
        
	  SELECT HI.ITEMID, HI.ITEMNAME, HI.ITEMCATEGORY, HI.AUCTIONSTARTTIME, HI.AUCTIONENDTIME, GETPRICE_FUNC(HI.ITEMID) AS CURRENTBID, GETSTATUS_FUNC(HI.ITEMID) AS STATUS
	  FROM HARAMBASE_ITEM HI 
	  WHERE (UPPER(HI.ITEMNAME) LIKE CONCAT('%', UPPER(KEYWORD) ,'%') OR SOUNDEX(KEYWORD) = SOUNDEX(HI.ITEMNAME))
	  AND TCATEGORY = HI.ITEMCATEGORY AND HARAMBASE_GETPRICE_FUNC(HI.ITEMID) <= CURBIDMAX AND CURBIDMIN <= HARAMBASE_GETPRICE_FUNC(HI.ITEMID) AND 
		TAUCTIONSTARTTIME <=  HI.AUCTIONSTARTTIME AND TAUCTIONENDTIME >= HI.AUCTIONENDTIME;
  ELSE IF KEYWORD IS NOT NULL 
        AND TCATEGORY IS NULL
        AND CURBIDMIN IS NOT NULL
        AND CURBIDMAX IS NOT NULL
        AND TAUCTIONSTARTTIME IS NOT NULL
        AND TAUCTIONENDTIME IS NOT NULL THEN
        
          SELECT HI.ITEMID, HI.ITEMNAME, HI.ITEMCATEGORY, HI.AUCTIONSTARTTIME, HI.AUCTIONENDTIME, GETPRICE_FUNC(HI.ITEMID) AS CURRENTBID, GETSTATUS_FUNC(HI.ITEMID) AS STATUS
          FROM HARAMBASE_ITEM HI 
          WHERE (uPPER(HI.ITEMNAME) LIKE CONCAT('%', UPPER(KEYWORD) ,'%') OR SOUNDEX(KEYWORD) = SOUNDEX(HI.ITEMNAME))
                AND HARAMBASE_GETPRICE_FUNC(HI.ITEMID) <= CURBIDMAX 
                AND CURBIDMIN <= HARAMBASE_GETPRICE_FUNC(HI.ITEMID) 
                AND TAUCTIONSTARTTIME <=  HI.AUCTIONSTARTTIME 
                AND TAUCTIONENDTIME >= HI.AUCTIONENDTIME;
  
  ELSE IF KEYWORD IS NOT NULL 
      AND TCATEGORY IS NOT NULL
      AND CURBIDMIN IS NULL
      AND CURBIDMAX IS NULL
      AND TAUCTIONSTARTTIME IS NOT NULL
      AND TAUCTIONENDTIME IS NOT NULL THEN
      
        SELECT HI.ITEMID, HI.ITEMNAME, HI.ITEMCATEGORY, HI.AUCTIONSTARTTIME, HI.AUCTIONENDTIME, GETPRICE_FUNC(HI.ITEMID) AS CURRENTBID, GETSTATUS_FUNC(HI.ITEMID) AS STATUS
        FROM HARAMBASE_ITEM HI 
        WHERE (UPPER(HI.ITEMNAME) LIKE CONCAT('%', UPPER(KEYWORD) ,'%') OR SOUNDEX(KEYWORD) = SOUNDEX(HI.ITEMNAME)) 
              AND TCATEGORY = HI.ITEMCATEGORY 
              AND TAUCTIONSTARTTIME <=  HI.AUCTIONSTARTTIME 
              AND TAUCTIONENDTIME >= HI.AUCTIONENDTIME;
        
   ELSE IF KEYWORD IS NOT NULL 
        AND TCATEGORY IS NOT NULL
        AND CURBIDMIN IS NOT NULL
        AND CURBIDMAX IS NOT NULL
        AND TAUCTIONSTARTTIME IS NULL
        AND TAUCTIONENDTIME IS NULL THEN
        
          SELECT HI.ITEMID, HI.ITEMNAME, HI.ITEMCATEGORY, HI.AUCTIONSTARTTIME, HI.AUCTIONENDTIME, GETPRICE_FUNC(HI.ITEMID) AS CURRENTBID, GETSTATUS_FUNC(HI.ITEMID) AS STATUS
          FROM HARAMBASE_ITEM HI 
          WHERE (UPPER(HI.ITEMNAME) LIKE CONCAT('%', UPPER(KEYWORD) ,'%') OR SOUNDEX(KEYWORD) = SOUNDEX(HI.ITEMNAME))
                AND TCATEGORY = HI.ITEMCATEGORY 
                AND HARAMBASE_GETPRICE_FUNC(HI.ITEMID) <= CURBIDMAX 
                AND CURBIDMIN <= HARAMBASE_GETPRICE_FUNC(HI.ITEMID);
 
   ELSE IF KEYWORD IS NOT NULL 
        AND TCATEGORY IS NULL
        AND CURBIDMIN IS NOT NULL
        AND CURBIDMAX IS NOT NULL
        AND TAUCTIONSTARTTIME IS NULL
        AND TAUCTIONENDTIME IS NULL THEN
        
          SELECT HI.ITEMID, HI.ITEMNAME, HI.ITEMCATEGORY, HI.AUCTIONSTARTTIME, HI.AUCTIONENDTIME, GETPRICE_FUNC(HI.ITEMID) AS CURRENTBID, GETSTATUS_FUNC(HI.ITEMID) AS STATUS 
          FROM HARAMBASE_ITEM HI 
          WHERE (UPPER(HI.ITEMNAME) LIKE CONCAT('%', UPPER(KEYWORD) ,'%') OR SOUNDEX(KEYWORD) = SOUNDEX(HI.ITEMNAME)) 
                AND HARAMBASE_GETPRICE_FUNC(HI.ITEMID) <= CURBIDMAX 
                AND CURBIDMIN <= HARAMBASE_GETPRICE_FUNC(HI.ITEMID);
   ELSE IF KEYWORD IS NOT NULL 
      AND TCATEGORY IS NULL
      AND CURBIDMIN IS NULL
      AND CURBIDMAX IS NULL
      AND TAUCTIONSTARTTIME IS NOT NULL
      AND TAUCTIONENDTIME IS NOT NULL THEN
        SELECT HI.ITEMID, HI.ITEMNAME, HI.ITEMCATEGORY, HI.AUCTIONSTARTTIME, HI.AUCTIONENDTIME, GETPRICE_FUNC(HI.ITEMID) AS CURRENTBID, GETSTATUS_FUNC(HI.ITEMID) AS STATUS
        FROM HARAMBASE_ITEM HI 
        WHERE (UPPER(HI.ITEMNAME) LIKE CONCAT('%', UPPER(KEYWORD) ,'%') OR SOUNDEX(KEYWORD) = SOUNDEX(HI.ITEMNAME)) 
              AND TAUCTIONSTARTTIME <=  HI.AUCTIONSTARTTIME 
              AND TAUCTIONENDTIME >= HI.AUCTIONENDTIME;
   
   ELSE IF KEYWORD IS NOT NULL 
      AND TCATEGORY IS NOT NULL
      AND CURBIDMIN IS NULL
      AND CURBIDMAX IS NULL
      AND TAUCTIONSTARTTIME IS  NULL
      AND TAUCTIONENDTIME IS NULL THEN
      
        SELECT HI.ITEMID, HI.ITEMNAME, HI.ITEMCATEGORY, HI.AUCTIONSTARTTIME, HI.AUCTIONENDTIME, GETPRICE_FUNC(HI.ITEMID) AS CURRENTBID, GETSTATUS_FUNC(HI.ITEMID) AS STATUS
        FROM HARAMBASE_ITEM HI 
        WHERE (UPPER(HI.ITEMNAME) LIKE CONCAT('%', UPPER(KEYWORD) ,'%') OR SOUNDEX(KEYWORD) = SOUNDEX(HI.ITEMNAME)) AND TCATEGORY = HI.ITEMCATEGORY;
                
   ELSE IF KEYWORD IS NOT NULL 
      AND TCATEGORY IS NULL 
      AND CURBIDMIN IS NULL 
      AND CURBIDMAX IS NULL 
      AND TAUCTIONSTARTTIME IS NULL 
      AND TAUCTIONENDTIME IS NULL THEN
      
        SELECT HI.ITEMID, HI.ITEMNAME, HI.ITEMCATEGORY, HI.AUCTIONSTARTTIME, HI.AUCTIONENDTIME, GETPRICE_FUNC(HI.ITEMID) AS CURRENTBID, GETSTATUS_FUNC(HI.ITEMID) AS STATUS
        FROM HARAMBASE_ITEM HI 
        WHERE UPPER(HI.ITEMNAME) LIKE CONCAT('%', UPPER(KEYWORD) ,'%') OR SOUNDEX(KEYWORD) = SOUNDEX(HI.ITEMNAME);  
  
  END IF;
  end if;
  end if;
  end if;
  end if;
  end if;
  END IF;
  END IF;
  END IF;
  
  
	    
END */$$
DELIMITER ;

/* Procedure structure for procedure `UPDATE_PROFILE_PRO` */

/*!50003 DROP PROCEDURE IF EXISTS  `UPDATE_PROFILE_PRO` */;

DELIMITER $$

/*!50003 CREATE DEFINER=`root`@`%` PROCEDURE `UPDATE_PROFILE_PRO`(
	IN URID INT,
	IN USERNAME VARCHAR(255),
	IN USEREMAIL VARCHAR(255),
	IN USERFNAME VARCHAR(255),
	IN USERLNAME VARCHAR(255),
	IN USERPASSWORD VARCHAR(255),
	OUT STATES INT
)
BEGIN
	SET STATES = 1;
	
	IF USERNAME IS NOT NULL THEN
	     UPDATE HARAMBASE_MEMBER SET UNAME = USERNAME WHERE USERID = URID;
	END IF;
	  
	IF USEREMAIL IS NOT NULL THEN
	    UPDATE HARAMBASE_MEMBER SET EMAIL = USEREMAIL WHERE USERID = URID;
	END IF;
	  
	IF USERFNAME IS NOT NULL THEN
	    UPDATE HARAMBASE_MEMBER SET FNAME = USERFNAME WHERE USERID = URID;
	END IF;
	  
	IF USERLNAME IS NOT NULL THEN
	    UPDATE HARAMBASE_MEMBER SET LNAME = USERLNAME WHERE USERID = URID;
	END IF;
	  
	IF USERPASSWORD IS NOT NULL THEN
	   UPDATE team2.HARAMBASE_MEMBER SET PASSWORD = USERPASSWORD WHERE USERID = URID;
	END IF;
	    
END */$$
DELIMITER ;

/*Table structure for table `list_of_bid_on` */

DROP TABLE IF EXISTS `list_of_bid_on`;

/*!50001 DROP VIEW IF EXISTS `list_of_bid_on` */;
/*!50001 DROP TABLE IF EXISTS `list_of_bid_on` */;

/*!50001 CREATE TABLE  `list_of_bid_on`(
 `ITEMID` int(11) unsigned NOT NULL ,
 `ITEMNAME` varchar(150) NULL ,
 `ITEMCATEGORY` varchar(50) NULL ,
 `AUCTIONSTARTTIME` timestamp(3) NOT NULL  default '0000-00-00 00:00:00.000' ,
 `AUCTIONENDTIME` timestamp(3) NOT NULL  default '0000-00-00 00:00:00.000' ,
 `USERID` int(11) NOT NULL ,
 `CURRENTPRICE` int(11) NULL ,
 `WINNER` int(11) NULL ,
 `STATUS` int(11) NULL 
)*/;

/*Table structure for table `list_of_bidders` */

DROP TABLE IF EXISTS `list_of_bidders`;

/*!50001 DROP VIEW IF EXISTS `list_of_bidders` */;
/*!50001 DROP TABLE IF EXISTS `list_of_bidders` */;

/*!50001 CREATE TABLE  `list_of_bidders`(
 `ITEMID` int(11) NOT NULL ,
 `BIDDERUNAME` varchar(100) NULL ,
 `BIDDINGTIME` timestamp(3) NOT NULL  default '0000-00-00 00:00:00.000' ,
 `MAXBIDLIMIT` double NULL ,
 `SOLDPRICE` int(11) NULL ,
 `STATUS` int(11) NULL ,
 `WINNER` varchar(100) NULL 
)*/;

/*Table structure for table `list_of_bought` */

DROP TABLE IF EXISTS `list_of_bought`;

/*!50001 DROP VIEW IF EXISTS `list_of_bought` */;
/*!50001 DROP TABLE IF EXISTS `list_of_bought` */;

/*!50001 CREATE TABLE  `list_of_bought`(
 `ITEMID` int(11) unsigned NOT NULL ,
 `ITEMNAME` varchar(150) NULL ,
 `ITEMCATEGORY` varchar(50) NULL ,
 `AUCTIONSTARTTIME` timestamp(3) NOT NULL  default '0000-00-00 00:00:00.000' ,
 `AUCTIONENDTIME` timestamp(3) NOT NULL  default '0000-00-00 00:00:00.000' ,
 `STARTPRICE` double NULL ,
 `SELLERNAME` varchar(100) NULL ,
 `SELLEREMAIL` varchar(100) NULL ,
 `USERID` int(11) NOT NULL ,
 `SOLDPRICE` int(11) NULL ,
 `FEEDBACK` varchar(300) NULL 
)*/;

/*Table structure for table `list_of_items` */

DROP TABLE IF EXISTS `list_of_items`;

/*!50001 DROP VIEW IF EXISTS `list_of_items` */;
/*!50001 DROP TABLE IF EXISTS `list_of_items` */;

/*!50001 CREATE TABLE  `list_of_items`(
 `ITEMID` int(11) unsigned NOT NULL ,
 `ITEMNAME` varchar(150) NULL ,
 `ITEMCATEGORY` varchar(50) NULL ,
 `AUCTIONSTARTTIME` timestamp(3) NOT NULL  default '0000-00-00 00:00:00.000' ,
 `AUCTIONENDTIME` timestamp(3) NOT NULL  default '0000-00-00 00:00:00.000' ,
 `SELLERID` int(11) NULL ,
 `STARTPRICE` double NULL ,
 `CURRENTPRICE` int(11) NULL ,
 `STATUS` int(11) NULL ,
 `WINNER` int(11) NULL 
)*/;

/*Table structure for table `overall_commission_view` */

DROP TABLE IF EXISTS `overall_commission_view`;

/*!50001 DROP VIEW IF EXISTS `overall_commission_view` */;
/*!50001 DROP TABLE IF EXISTS `overall_commission_view` */;

/*!50001 CREATE TABLE  `overall_commission_view`(
 `userID` int(10) NOT NULL ,
 `User_Name` varchar(100) NULL ,
 `First_Name` varchar(50) NULL ,
 `Last_Name` varchar(50) NULL ,
 `Email` varchar(100) NULL ,
 `Seller_Rating` double NULL ,
 `COMMISSIONS` decimal(35,2) NULL 
)*/;

/*Table structure for table `sales_summary_report` */

DROP TABLE IF EXISTS `sales_summary_report`;

/*!50001 DROP VIEW IF EXISTS `sales_summary_report` */;
/*!50001 DROP TABLE IF EXISTS `sales_summary_report` */;

/*!50001 CREATE TABLE  `sales_summary_report`(
 `ITEMCATEGORY` varchar(50) NULL ,
 `ITEMID` int(11) unsigned NOT NULL ,
 `ITEMNAME` varchar(150) NULL ,
 `FINAL_SELLING_PRICE` int(11) NULL ,
 `COMMISSION` decimal(13,2) NULL 
)*/;

/*View structure for view list_of_bid_on */

/*!50001 DROP TABLE IF EXISTS `list_of_bid_on` */;
/*!50001 DROP VIEW IF EXISTS `list_of_bid_on` */;

/*!50001 CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`%` SQL SECURITY DEFINER VIEW `list_of_bid_on` AS select `i`.`ITEMID` AS `ITEMID`,`i`.`ITEMNAME` AS `ITEMNAME`,`i`.`ITEMCATEGORY` AS `ITEMCATEGORY`,`i`.`AUCTIONSTARTTIME` AS `AUCTIONSTARTTIME`,`i`.`AUCTIONENDTIME` AS `AUCTIONENDTIME`,`b`.`USERID` AS `USERID`,`GETPRICE_FUNC`(`i`.`ITEMID`) AS `CURRENTPRICE`,`GETWINNER_FUNC`(`i`.`ITEMID`) AS `WINNER`,`GETSTATUS_FUNC`(`i`.`ITEMID`) AS `STATUS` from (`harambase_item` `i` join `harambase_bid` `b`) where (`i`.`ITEMID` = `b`.`ITEMID`) */;

/*View structure for view list_of_bidders */

/*!50001 DROP TABLE IF EXISTS `list_of_bidders` */;
/*!50001 DROP VIEW IF EXISTS `list_of_bidders` */;

/*!50001 CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`%` SQL SECURITY DEFINER VIEW `list_of_bidders` AS select `b`.`ITEMID` AS `ITEMID`,`m1`.`UNAME` AS `BIDDERUNAME`,`b`.`BIDDINGTIME` AS `BIDDINGTIME`,`b`.`MAXBIDLIMIT` AS `MAXBIDLIMIT`,`GETPRICE_FUNC`(`b`.`ITEMID`) AS `SOLDPRICE`,`GETSTATUS_FUNC`(`b`.`ITEMID`) AS `STATUS`,`m2`.`UNAME` AS `WINNER` from ((`harambase_bid` `b` join `harambase_member` `m1`) join `harambase_member` `m2`) where ((`m1`.`USERID` = `b`.`USERID`) and (`m2`.`USERID` = `GETWINNER_FUNC`(`b`.`ITEMID`))) order by `b`.`ITEMID` */;

/*View structure for view list_of_bought */

/*!50001 DROP TABLE IF EXISTS `list_of_bought` */;
/*!50001 DROP VIEW IF EXISTS `list_of_bought` */;

/*!50001 CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`%` SQL SECURITY DEFINER VIEW `list_of_bought` AS select `i`.`ITEMID` AS `ITEMID`,`i`.`ITEMNAME` AS `ITEMNAME`,`i`.`ITEMCATEGORY` AS `ITEMCATEGORY`,`i`.`AUCTIONSTARTTIME` AS `AUCTIONSTARTTIME`,`i`.`AUCTIONENDTIME` AS `AUCTIONENDTIME`,`i`.`STARTPRICE` AS `STARTPRICE`,`s`.`UNAME` AS `SELLERNAME`,`s`.`EMAIL` AS `SELLEREMAIL`,`b`.`USERID` AS `USERID`,`GETPRICE_FUNC`(`i`.`ITEMID`) AS `SOLDPRICE`,`f`.`COMMENTS` AS `FEEDBACK` from (((`harambase_item` `i` join `harambase_member` `s`) join `harambase_bid` `b`) join `harambase_feedback` `f`) where ((`i`.`ITEMID` = `b`.`ITEMID`) and (`GETSTATUS_FUNC`(`i`.`ITEMID`) = 1) and (`b`.`USERID` = `GETWINNER_FUNC`(`i`.`ITEMID`)) and (`i`.`SELLERID` = `s`.`USERID`) and (`f`.`ITEMID` = `i`.`ITEMID`)) */;

/*View structure for view list_of_items */

/*!50001 DROP TABLE IF EXISTS `list_of_items` */;
/*!50001 DROP VIEW IF EXISTS `list_of_items` */;

/*!50001 CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`%` SQL SECURITY DEFINER VIEW `list_of_items` AS select `i`.`ITEMID` AS `ITEMID`,`i`.`ITEMNAME` AS `ITEMNAME`,`i`.`ITEMCATEGORY` AS `ITEMCATEGORY`,`i`.`AUCTIONSTARTTIME` AS `AUCTIONSTARTTIME`,`i`.`AUCTIONENDTIME` AS `AUCTIONENDTIME`,`i`.`SELLERID` AS `SELLERID`,`i`.`STARTPRICE` AS `STARTPRICE`,`GETPRICE_FUNC`(`i`.`ITEMID`) AS `CURRENTPRICE`,`GETSTATUS_FUNC`(`i`.`ITEMID`) AS `STATUS`,`GETWINNER_FUNC`(`i`.`ITEMID`) AS `WINNER` from `harambase_item` `i` */;

/*View structure for view overall_commission_view */

/*!50001 DROP TABLE IF EXISTS `overall_commission_view` */;
/*!50001 DROP VIEW IF EXISTS `overall_commission_view` */;

/*!50001 CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`%` SQL SECURITY DEFINER VIEW `overall_commission_view` AS select `hm`.`USERID` AS `userID`,`hm`.`UNAME` AS `User_Name`,`hm`.`FNAME` AS `First_Name`,`hm`.`LNAME` AS `Last_Name`,`hm`.`EMAIL` AS `Email`,avg(`hf`.`OVERALLRATING`) AS `Seller_Rating`,sum(`sr`.`COMMISSION`) AS `COMMISSIONS` from ((`harambase_feedback` `hf` join `harambase_member` `hm`) join `sales_summary_report` `sr`) where `hm`.`USERID` in (select `item`.`SELLERID` from `harambase_item` `item` where ((`item`.`ITEMID` = `sr`.`ITEMID`) and (`item`.`ITEMID` = `hf`.`ITEMID`))) group by `hm`.`USERID`,`hm`.`UNAME`,`hm`.`FNAME`,`hm`.`LNAME`,`hm`.`EMAIL` order by `hm`.`USERID` */;

/*View structure for view sales_summary_report */

/*!50001 DROP TABLE IF EXISTS `sales_summary_report` */;
/*!50001 DROP VIEW IF EXISTS `sales_summary_report` */;

/*!50001 CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`%` SQL SECURITY DEFINER VIEW `sales_summary_report` AS select `item`.`ITEMCATEGORY` AS `ITEMCATEGORY`,`item`.`ITEMID` AS `ITEMID`,`item`.`ITEMNAME` AS `ITEMNAME`,`GETPRICE_FUNC`(`item`.`ITEMID`) AS `FINAL_SELLING_PRICE`,(`GETPRICE_FUNC`(`item`.`ITEMID`) * 0.05) AS `COMMISSION` from `harambase_item` `item` where (`GETSTATUS_FUNC`(`item`.`ITEMID`) = 1) order by `item`.`ITEMCATEGORY`,`item`.`ITEMID` */;

/*!40101 SET SQL_MODE=@OLD_SQL_MODE */;
/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */;
/*!40014 SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS */;
/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */;
