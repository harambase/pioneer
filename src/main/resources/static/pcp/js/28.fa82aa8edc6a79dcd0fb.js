webpackJsonp([28],{1083:function(t,e,s){"use strict";var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"animated fadeIn"},[s("b-row",[s("b-card",{attrs:{"header-tag":"header","footer-tag":"footer"}},[s("div",{attrs:{slot:"header"},slot:"header"},[s("i",{attrs:{className:"fa fa-align-justify"}}),s("strong",[t._v("系统用户列表")])]),t._v(" "),s("b-card-body",[s("b-row",[s("b-button",{on:{click:t.downloadUserList}},[t._v("下载用户表")])],1),t._v(" "),s("b-row",[s("b-col",{staticClass:"my-1",attrs:{md:"1"}},[s("legend",{staticClass:"col-form-legend"},[t._v("每页显示：")])]),t._v(" "),s("b-col",{staticClass:"my-1",attrs:{md:"1"}},[s("b-form-group",[s("b-form-select",{attrs:{options:t.pageOptions},model:{value:t.perPage,callback:function(e){t.perPage=e},expression:"perPage"}})],1)],1),t._v(" "),s("b-col",{staticClass:"my-1",attrs:{md:"1"}},[s("legend",{staticClass:"col-form-legend"},[t._v("用户类型：")])]),t._v(" "),s("b-col",{staticClass:"my-1",attrs:{md:"1"}},[s("b-form-group",[s("b-form-select",{attrs:{options:t.typeOptions},model:{value:t.type,callback:function(e){t.type=e},expression:"type"}})],1)],1),t._v(" "),s("b-col",{staticClass:"my-1",attrs:{md:"1"}},[s("legend",{staticClass:"col-form-legend"},[t._v("用户权限：")])]),t._v(" "),s("b-col",{staticClass:"my-1",attrs:{md:"1"}},[s("b-form-group",[s("b-form-select",{attrs:{options:[{text:"管理员",value:"1"},{text:"系统",value:"4"},{text:"教务",value:"2"},{text:"导师",value:"7"},{text:"学生",value:"5"},{text:"教师",value:"6"},{text:"后勤",value:"3"},{text:"全部",value:"0"}]},model:{value:t.role,callback:function(e){t.role=e},expression:"role"}})],1)],1),t._v(" "),s("b-col",{staticClass:"my-1",attrs:{md:"1"}},[s("legend",{staticClass:"col-form-legend"},[t._v("账户启停：")])]),t._v(" "),s("b-col",{staticClass:"my-1",attrs:{md:"1"}},[s("b-form-group",[s("b-form-select",{attrs:{options:[{text:"启用",value:"1"},{text:"停用",value:"0"},{text:"全部",value:""}]},model:{value:t.viewStatus,callback:function(e){t.viewStatus=e},expression:"viewStatus"}})],1)],1),t._v(" "),s("b-col",{staticClass:"my-1",attrs:{md:"4"}},[s("b-form-group",[s("b-input-group",[s("b-input-group-button",[s("div",{staticClass:"mt-2"},[t._v("\n                    搜索：\n                  ")])]),t._v(" "),s("b-form-input",{model:{value:t.filter,callback:function(e){t.filter=e},expression:"filter"}}),t._v(" "),s("b-input-group-button",[s("b-button",{attrs:{variant:"danger",disabled:!t.filter},on:{click:function(e){t.filter=""}}},[t._v("重置")])],1)],1)],1)],1)],1),t._v(" "),s("b-table",{ref:"userTable",attrs:{"show-empty":"",stacked:"sm",striped:!0,fixed:!0,hover:!0,items:t.userTable,fields:t.field,"current-page":t.currentPage,"per-page":t.perPage,filter:t.filter,"sort-by":t.sortBy,"sort-desc":t.sortDesc,isBusy:!1},on:{"update:sortBy":function(e){t.sortBy=e},"update:sortDesc":function(e){t.sortDesc=e},filtered:t.onFiltered},scopedSlots:t._u([{key:"index",fn:function(e){return[t._v("\n            "+t._s((t.currentPage-1)*t.perPage+1+e.index)+"\n          ")]}},{key:"userId",fn:function(e){return[s("b-row",[s("b-col",{attrs:{md:"3"}},[t.isNotEmpty(e.item.profile)?s("img",{staticClass:"img-avatar",staticStyle:{width:"30px",height:"30px"},attrs:{src:t.basePath+"/static"+JSON.parse(e.item.profile).path}}):s("img",{staticClass:"img-avatar",staticStyle:{width:"30px",height:"30px"},attrs:{src:t.basePath+"/static/img/logo.png"}})]),t._v(" "),s("b-col",{staticClass:"mt-1",staticStyle:{"font-size":"11px"},attrs:{md:"9"}},[t._v("\n                "+t._s(e.value)+"\n              ")])],1)]}},{key:"updateTime",fn:function(e){return[s("p",{staticClass:"mt-1",staticStyle:{"font-size":"11px"}},[t._v("\n              "+t._s(e.value)+"\n            ")])]}},{key:"lastLoginTime",fn:function(e){return[s("p",{staticClass:"mt-1",staticStyle:{"font-size":"11px"}},[t._v("\n              "+t._s(e.value)+"\n            ")])]}},{key:"status",fn:function(e){return[s("label",{staticClass:"switch switch-lg switch-text switch-success mb-0"},[s("input",{staticClass:"switch-input",attrs:{type:"checkbox"},domProps:{checked:"1"===e.item.status},on:{change:function(s){t.inverseStatus(e.item.userId,e.item.status)}}}),t._v(" "),s("span",{staticClass:"switch-label",attrs:{"data-on":"启用","data-off":"停用"}}),t._v(" "),s("span",{staticClass:"switch-handle"})])]}},{key:"actions",fn:function(e){return[s("b-button",{staticClass:"btn btn-success",attrs:{size:"sm"},on:{click:function(t){return t.stopPropagation(),e.toggleDetails(t)}}},[t._v("\n              "+t._s(e.detailsShowing?"隐藏":"展示")+"详情\n            ")])]}},{key:"row-details",fn:function(e){return[s("b-card",[s("b-list-group",[s("b-list-group-item",{staticClass:"flex-column align-items-start",attrs:{href:"#",title:"编辑用户",disabled:"0"===e.item.status}},[s("div",{staticClass:"d-flex w-100 justify-content-between"},[s("h5",{staticClass:"mb-1"},[t._v("用户 "),s("strong",[t._v(t._s(e.item.lastName)+", "+t._s(e.item.firstName))]),t._v(" 的基本信息")]),t._v(" "),s("small",{staticClass:"text-muted"},[t._v("用户ID："+t._s(e.item.userId))])]),t._v(" "),s("hr"),t._v(" "),s("b-row",[s("b-col",{staticClass:"my-1",attrs:{md:"9"}},[s("div",{staticClass:"mr-1"},[s("dl",{staticClass:"row"},[s("dt",{staticClass:"col-sm-1"},[t._v("QQ:")]),t._v(" "),s("dd",{staticClass:"col-sm-2"},[t._v(t._s(e.item.qq))]),t._v(" "),s("dt",{staticClass:"col-sm-1"},[t._v("电话:")]),t._v(" "),s("dd",{staticClass:"col-sm-2"},[t._v(t._s(e.item.tel))]),t._v(" "),s("dt",{staticClass:"col-sm-1"},[t._v("微信:")]),t._v(" "),s("dd",{staticClass:"col-sm-2"},[t._v(t._s(e.item.weChat))])]),t._v(" "),s("dl",{staticClass:"row"},[s("dt",{staticClass:"col-sm-1"},[t._v("性别:")]),t._v(" "),s("dd",{staticClass:"col-sm-2"},[t._v(t._s(e.item.gender))]),t._v(" "),s("dt",{staticClass:"col-sm-1"},[t._v("宿舍:")]),t._v(" "),s("dd",{staticClass:"col-sm-2"},[t._v(t._s(e.item.dorm))])]),t._v(" "),s("dl",{staticClass:"row"},[s("dt",{staticClass:"col-sm-1"},[t._v("邮箱:")]),t._v(" "),s("dd",{staticClass:"col-sm-3"},[t._v(t._s(e.item.email))]),t._v(" "),s("dt",{staticClass:"col-sm-1"},[t._v("住址:")]),t._v(" "),s("dd",{staticClass:"col-sm-3"},[t._v(t._s(e.item.address))])]),t._v(" "),s("dl",{staticClass:"row"},[s("dt",{staticClass:"col-sm-2"},[t._v("基本信息表:")]),t._v(" "),t.isNotEmpty(e.item.userInfo)?s("dd",{staticClass:"col-sm-5"},[s("a",{attrs:{href:"#"},on:{click:function(s){t.documentDownload(e.item.userId)}}},[t._v(t._s(JSON.parse(e.item.userInfo).name))])]):t._e()]),t._v(" "),s("dl",{staticClass:"row"},[s("dt",{staticClass:"col-sm-1"},[t._v("备注:")]),t._v(" "),s("dd",{staticClass:"col-sm-5"},[t._v(t._s(e.item.comment))])]),t._v(" "),s("hr"),t._v(" "),s("dl",{staticClass:"row"},[s("dt",{staticClass:"col-sm-1"},[t._v("操作:")]),t._v(" "),s("dd",{staticClass:"col-sm-5"},[s("b-button",{attrs:{size:"sm",variant:"danger"},on:{click:function(s){s.stopPropagation(),t.showDeleteTempUser(e.item.userId)}}},[t._v("\n                              删除该用户\n                            ")]),t._v(" "),s("b-button",{attrs:{size:"sm",variant:"primary"},on:{click:function(s){t.userDetail(e.item.userId)}}},[t._v("\n                              修改该用户\n                            ")])],1)])])]),t._v(" "),s("b-col",{staticClass:"my-1",attrs:{md:"3"}},[t.isNotEmpty(e.item.profile)?s("img",{staticClass:"img-avatar",staticStyle:{width:"70%"},attrs:{src:t.basePath+"/static"+JSON.parse(e.item.profile).path}}):s("img",{staticClass:"img-avatar",staticStyle:{width:"70%"},attrs:{src:t.basePath+"/static/img/logo.png"}})])],1)],1)],1)],1)]}}])}),t._v(" "),s("b-row",[s("b-col",{staticClass:"my-1",attrs:{md:"6"}},[s("b-pagination",{staticClass:"my-0",attrs:{"total-rows":t.totalRows,"per-page":t.perPage},model:{value:t.currentPage,callback:function(e){t.currentPage=e},expression:"currentPage"}})],1),t._v(" "),s("b-col",{staticClass:"my-1",attrs:{md:"6"}},[s("p",{staticClass:"text-muted",staticStyle:{"text-align":"right"}},[t._v(" 显示 "+t._s((t.currentPage-1)*t.perPage+1)+" 至\n              "+t._s((t.currentPage-1)*t.perPage+t.perPage<=t.totalRows?(t.currentPage-1)*t.perPage+t.perPage:t.totalRows)+" 条 ，总共 "+t._s(t.totalRows)+" 条数据 ")])])],1)],1)],1)],1),t._v(" "),s("b-modal",{attrs:{size:"sm","header-bg-variant":"danger",centered:"",title:"不可逆操作警告！"},on:{ok:t.deleteUser},model:{value:t.showDeleteModal,callback:function(e){t.showDeleteModal=e},expression:"showDeleteModal"}},[s("div",{staticClass:"d-block text-center"},[s("h3",[t._v("确认删除该用户？")])])]),t._v(" "),s("b-modal",{attrs:{size:"sm","header-bg-variant":t.headerBgVariant,"ok-only":"","ok-title":"关闭",centered:"",title:"消息"},on:{ok:t.initTable},model:{value:t.showModal,callback:function(e){t.showModal=e},expression:"showModal"}},[s("div",{staticClass:"d-block text-center"},[s("h4",[t._v(t._s(t.msg))])])])],1)},l=[],i={render:a,staticRenderFns:l};e.a=i},408:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=s(748),l=s(1083),i=s(150),r=i(a.a,l.a,!1,null,null,null);e.default=r.exports},748:function(t,e,s){"use strict";var a=s(151),l=s.n(a),i=[],r=[{key:"index",label:"序号",class:"text-center"},{key:"userId",label:"用户ID",sortable:!0},{key:"username",label:"用户名",sortable:!0},{key:"lastName",label:"姓",sortable:!0},{key:"firstName",label:"名",sortable:!0},{key:"type",label:"账户类型",sortable:!0},{key:"status",label:"启停状态",sortable:!0},{key:"updateTime",label:"最近更新时间",sortable:!0},{key:"lastLoginTime",label:"上次登录时间",sortable:!0},{key:"actions",label:"操作"}];e.a={name:"User",data:function(){return{profilePath:"",pageMode:this.$route.fullPath.split("&")[0].split("=")[1],goTo:"",msg:"",showModal:!1,showDeleteModal:!1,headerBgVariant:"",field:r,currentPage:1,perPage:10,totalRows:0,pageOptions:[5,10,15],typeOptions:[{text:"教师",value:"f"},{text:"学生",value:"s"},{text:"系统管理",value:"a"},{text:"全部",value:""}],type:"",sortBy:"user_id",sortDesc:!1,filter:null,items:i,status:"",viewStatus:"",basePath:basePath,deleteUserId:"",role:"0"}},computed:{sortOptions:function(){return this.field.filter(function(t){return t.sortable}).map(function(t){return{text:t.label,value:t.key}})}},watch:{type:function(){this.initTable()},viewStatus:function(){this.initTable()},role:function(){this.initTable()}},methods:{documentDownload:function(t){window.open(basePath+"/user/info/"+t+"?token="+window.localStorage.getItem("access_token"))},previewImg:function(){var t=document.getElementById("preview"),e=document.querySelector("input[type=file]").files[0],s=new FileReader;e?s.readAsDataURL(e):t.src="",s.onloadend=function(){t.src=s.result}},showDeleteTempUser:function(t){this.showDeleteModal=!0,this.deleteUserId=t},deleteUser:function(){var t=this;l.a.delete("/user/"+this.deleteUserId).then(function(e){2001===e.data.code?(t.msg="删除成功!",t.showModal=!0,t.headerBgVariant="success",t.initTable()):(t.msg=e.data.msg,t.showModal=!0,t.headerBgVariant="danger")})},inverseStatus:function(t,e){var s=this,a="1";"1"===e&&(a="0"),l.a.get("/user/"+t).then(function(e){var i=e.data.data;i.status=a,l.a.put("/user/"+t,i).then(function(t){2001===t.data.code?(s.initTable(),s.showModal=!0,s.msg="状态修改成功！",s.headerBgVariant="success"):(s.showModal=!0,s.msg="状态修改失败！",s.headerBgVariant="danger")})})},userDetail:function(t){this.$router.push({path:"/system/user/detail?mode=view&userId="+t})},onFiltered:function(t){this.totalRows=t.length,this.currentPage=1},initTable:function(){this.$refs.userTable.refresh()},userTable:function(t){var e=this;this.isBusy=!0;var s="/user?type="+this.type+"&status="+this.viewStatus+"&role="+this.role+"&start="+t.currentPage+"&length="+t.perPage+"&orderCol=";switch(t.sortBy){case"userId":s+="user_id";break;case"lastName":s+="last_name";break;case"firstName":s+="first_name";break;case"updateTime":s+="update_time";break;case"lastLoginTime":s+="last_login_time";break;default:s+=t.sortBy}return this.isNotEmpty(t.filter)&&(s+="&search="+t.filter),t.sortDesc?s+="&order=desc":s+="&order=asc",l.a.get(s).then(function(t){var s=t.data.data;return e.totalRows=t.data.recordsTotal,s||[]})},isNotEmpty:function(t){return""!==t&&void 0!==t&&null!==t},downloadUserList:function(){window.open(basePath+"/user/list/?type=s&token="+window.localStorage.getItem("access_token"))}}}}});
//# sourceMappingURL=28.fa82aa8edc6a79dcd0fb.js.map