webpackJsonp([15],{404:function(t,a,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var s=e(649),o=e(759),i=e(21),r=i(s.a,o.a,!1,null,null,null);a.default=r.exports},468:function(t,a,e){"use strict";var s=e(138),o=e.n(s),i=e(476),r=[],n=[{key:"actions",label:""},{key:"sender",label:"发件人"},{key:"subject",label:"主题"},{key:"date",label:"发件时间"}];a.a={name:"c-messageTable",props:["mode","info","id"],components:{CMessageDetail:i.a},data:function(){return{field:n,currentPage:1,perPage:10,totalRows:0,pageOptions:[5,10,15],sortBy:"date",sortDesc:!0,filter:null,items:r,info:"",showDeleteModal:!1,showModal:!1,advisor:"",msg:"",headerBgVariant:"",basePath:basePath,box:"inbox"}},watch:{mode:function(t){switch(t){case"first":this.box="inbox";break;case"second":this.box="important";break;case"third":this.box="urgent";break;case"fourth":this.box="trash";break;case"fifth":this.box="sent"}this.initTable()},id:function(t){this.initTable()}},computed:{sortOptions:function(){return this.field.filter(function(t){return t.sortable}).map(function(t){return{text:t.label,value:t.key}})}},methods:{showDetail:function(t){this.$router.push({path:"/message?id="+t.id})},onFiltered:function(t){this.totalRows=t.length,this.currentPage=1},initTable:function(){this.$refs.messageTable.refresh()},messageTable:function(t){var a=this;this.isBusy=!0;var e="/message/list?start="+t.currentPage+"&length="+t.perPage+"&orderCol=";return this.isNotEmpty(t.filter)&&(e+="&search="+t.filter),this.isNotEmpty(this.box)&&(e+="&box="+this.box),t.sortDesc?e+="&order=desc":e+="&order=asc",o.a.get(e).then(function(t){var e=t.data.data;if(a.totalRows=t.data.recordsTotal,isNotEmpty(a.id))for(var s=0;s<e.length;s++)if(a.id==e[s].id){e[s]._showDetails=!0,e[s]._rowVariant="danger";var o=e[0];e[0]=e[s],e[s]=o;break}return e||[]})},isNotEmpty:function(t){return""!==t&&void 0!==t&&null!==t}}}},469:function(t,a,e){"use strict";var s=e(138),o=e.n(s);a.a={name:"c-messageDetail",props:["row","info"],data:function(){return{msg:"",showModal:!1,showDeleteModal:!1,headerBgVariant:"",basePath:basePath,deleteId:""}},mounted:function(){var t=this;this.info.unread--,"重要"==this.row.item.labels&&this.info.important--,"紧急"==this.row.item.labels&&this.info.urgent--,this.row.item.status="read",o.a.put("/message/"+this.row.item.id,this.row.item).then(function(a){2001!==a.data.code&&(t.msg=a.data.msg,t.showModal=!0,t.headerBgVariant="danger")})},methods:{showDeleteMessage:function(t){this.deleteId=t,this.showDeleteModal=!0},deleteMessage:function(){var t=this;o.a.delete("/message/"+this.deleteId).then(function(a){2001===a.data.code?(t.msg=a.data.msg,t.showModal=!0,t.headerBgVariant="success",t.$router.go(0)):(t.msg=a.data.msg,t.showModal=!0,t.headerBgVariant="danger")})},markAsRead:function(){var t=this;this.info.unread--,"重要"==this.row.item.labels&&this.info.important--,"紧急"==this.row.item.labels&&this.info.urgent--,this.row.item.status="read",o.a.put("/message/"+this.row.item.id,this.row.item).then(function(a){2001!==a.data.code&&(t.msg=a.data.msg,t.showModal=!0,t.headerBgVariant="danger")})},markAsUnread:function(){var t=this;this.info.unread++,"重要"==this.row.item.labels&&this.info.important++,"紧急"==this.row.item.labels&&this.info.urgent++,this.row.item.status="unread",o.a.put("/message/"+this.row.item.id,this.row.item).then(function(a){2001!==a.data.code&&(t.msg=a.data.msg,t.showModal=!0,t.headerBgVariant="danger")})},moveToInbox:function(){var t=this;this.row.item.status="read",o.a.put("/message/"+this.row.item.id,this.row.item).then(function(a){t.$router.go(0),2001!==a.data.code&&(t.msg=a.data.msg,t.showModal=!0,t.headerBgVariant="danger")})},moveToTrash:function(){var t=this;this.row.item.status="trashed",o.a.put("/message/"+this.row.item.id,this.row.item).then(function(a){t.$router.go(0),2001!==a.data.code&&(t.msg=a.data.msg,t.showModal=!0,t.headerBgVariant="danger")})},isNotEmpty:function(t){return""!==t&&void 0!==t&&null!==t}}}},476:function(t,a,e){"use strict";var s=e(469),o=e(515),i=e(21),r=i(s.a,o.a,!1,null,null,null);a.a=r.exports},514:function(t,a,e){"use strict";var s=e(468),o=e(516),i=e(21),r=i(s.a,o.a,!1,null,null,null);a.a=r.exports},515:function(t,a,e){"use strict";var s=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("b-card",[e("b-list-group",[e("b-list-group-item",{staticClass:"flex-column align-items-start",staticStyle:{background:"#f4f6f8"},attrs:{title:t.row.item.title,disabled:""}},[e("div",{staticClass:"d-flex w-100 justify-content-between"},[e("h5",{staticStyle:{color:"darkblue"}},[e("strong",[t._v(t._s(t.row.item.title)+"\n          "),e("small",[t._v(t._s(t.row.item.tag)+"消息")])])])]),t._v(" "),e("hr"),t._v(" "),e("div",{staticClass:"mr-1"},[e("b-row",[e("b-col",{attrs:{md:"8"}},[e("dl",{staticClass:"row"},[e("dt",{staticClass:"col-sm-4"},[t._v("发件人:")]),t._v(" "),e("dd",{staticClass:"col-sm-4"},[t._v(t._s(t.row.item.sender))])]),t._v(" "),e("dl",{staticClass:"row"},[e("dt",{staticClass:"col-sm-4"},[t._v("发件时间:")]),t._v(" "),e("dd",{staticClass:"col-sm-4"},[t._v(t._s(t.row.item.date))])]),t._v(" "),e("dl",{staticClass:"row"},[e("dt",{staticClass:"col-sm-4"},[t._v("收件人:")]),t._v(" "),e("dd",{staticClass:"col-sm-4"},[t._v(t._s(t.row.item.receiver))])]),t._v(" "),e("dl",{staticClass:"row"},[e("dt",{staticClass:"col-sm-4"},[t._v("主题:")]),t._v(" "),e("dd",{staticClass:"col-sm-4"},[t._v(t._s(t.row.item.subject))])]),t._v(" "),e("dl",{staticClass:"row"},[e("dt",{staticClass:"col-sm-4"},[t._v("正文:")]),t._v(" "),e("dd",{staticClass:"col-sm-8",staticStyle:{color:"orangered"}},[e("p",{domProps:{innerHTML:t._s(t.row.item.body)}})])])]),t._v(" "),e("b-col",{attrs:{md:"4"}},[e("b-row",[t.isNotEmpty(t.row.item.pic)?e("img",{staticClass:"img-avatar",attrs:{src:t.basePath+"/static"+JSON.parse(t.row.item.pic).path}}):e("img",{staticClass:"img-avatar",attrs:{src:t.basePath+"/static/img/logo.png"}})]),t._v(" "),e("b-row",[e("dl",{staticClass:"row"},[e("dt",{staticClass:"col-sm-7"},[t._v("发件人联系电话:")]),t._v(" "),e("dd",{staticClass:"col-sm-7"},[t._v(t._s(t.row.item.tel))]),t._v(" "),e("dt",{staticClass:"col-sm-7"},[t._v("发件人电子邮件:")]),t._v(" "),e("dd",{staticClass:"col-sm-7"},[t._v(t._s(t.row.item.email))])])])],1)],1),t._v(" "),e("hr"),t._v(" "),e("b-row",[e("b-col",{attrs:{md:"12"}},[e("dl",{staticClass:"row"},[e("dt",{staticClass:"col-sm-1"},[t._v("操作:")]),t._v(" "),e("dd",{staticClass:"col-sm-5"},["read"==t.row.item.status?e("b-button",{attrs:{size:"sm",variant:"success"},on:{click:function(a){a.stopPropagation(),t.markAsUnread()}}},[t._v("\n                  标记为未读\n                ")]):t._e(),t._v(" "),"unread"==t.row.item.status?e("b-button",{attrs:{size:"sm",variant:"success"},on:{click:function(a){a.stopPropagation(),t.markAsRead()}}},[t._v("\n                  标记为已读\n                ")]):t._e(),t._v(" "),"trashed"!=t.row.item.status?e("b-button",{attrs:{size:"sm",variant:"primary"},on:{click:function(a){a.stopPropagation(),t.moveToTrash()}}},[t._v("\n                  移入垃圾箱\n                ")]):t._e(),t._v(" "),"trashed"==t.row.item.status?e("b-button",{attrs:{size:"sm",variant:"primary"},on:{click:function(a){a.stopPropagation(),t.moveToInbox()}}},[t._v("\n                  移入收件箱\n                ")]):t._e(),t._v(" "),e("b-button",{attrs:{size:"sm",variant:"danger"},on:{click:function(a){a.stopPropagation(),t.showDeleteMessage(t.row.item.id)}}},[t._v("\n                  彻底删除\n                ")]),t._v(" "),e("b-button",{attrs:{size:"sm",variant:"primary"},on:{click:function(a){a.stopPropagation(),t.row.toggleDetails(a)}}},[t._v("\n                  关闭信息\n                ")])],1)])])],1)],1)])],1),t._v(" "),e("b-modal",{attrs:{size:"sm","header-bg-variant":"danger",centered:"",title:"不可逆操作警告！"},on:{ok:t.deleteMessage},model:{value:t.showDeleteModal,callback:function(a){t.showDeleteModal=a},expression:"showDeleteModal"}},[e("div",{staticClass:"d-block text-center"},[e("h3",[t._v("确认删除该消息？")])])]),t._v(" "),e("b-modal",{attrs:{size:"sm","header-bg-variant":t.headerBgVariant,"ok-only":"","ok-title":"关闭",centered:"",title:"消息"},on:{ok:t.row.toggleDetails},model:{value:t.showModal,callback:function(a){t.showModal=a},expression:"showModal"}},[e("div",{staticClass:"d-block text-center"},[e("h3",[t._v(t._s(t.msg))])])])],1)},o=[],i={render:s,staticRenderFns:o};a.a=i},516:function(t,a,e){"use strict";var s=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",[e("b-row",[e("b-col",{attrs:{md:"9"}},[e("b-table",{ref:"messageTable",staticStyle:{cursor:"pointer"},attrs:{"show-empty":"",stacked:"sm",fixed:!0,hover:!0,items:t.messageTable,fields:t.field,"current-page":t.currentPage,"per-page":t.perPage,filter:t.filter,"sort-by":t.sortBy,"sort-desc":t.sortDesc,isBusy:!1},on:{"update:sortBy":function(a){t.sortBy=a},"update:sortDesc":function(a){t.sortDesc=a},"row-clicked":t.showDetail,filtered:t.onFiltered},scopedSlots:t._u([{key:"actions",fn:function(a){return[e("div",{staticClass:"ml-4"},[e("b-row",["重要"==a.item.labels?e("span",[e("i",{staticClass:"el-icon-warning",staticStyle:{color:"blue"}}),t._v(" 重要信息")]):t._e(),t._v(" "),"紧急"==a.item.labels?e("span",[e("i",{staticClass:"el-icon-warning",staticStyle:{color:"red"}}),t._v(" 紧急信息")]):t._e()]),t._v(" "),e("b-row",["unread"==a.item.status?e("span",[e("i",{staticClass:"fa fa-envelope",staticStyle:{color:"orange"}}),t._v(" 未读信息 ")]):t._e(),t._v(" "),"read"==a.item.status?e("span",[e("i",{staticClass:"fa fa-envelope-open"}),t._v(" 已读信息")]):t._e()])],1)]}},{key:"row-details",fn:function(a){return[e("CMessageDetail",{attrs:{row:a,info:t.info}})]}}])}),t._v(" "),e("b-row",[e("b-col",{staticClass:"my-1",attrs:{md:"6"}},[e("b-pagination",{staticClass:"my-0",attrs:{"total-rows":t.totalRows,"per-page":t.perPage},model:{value:t.currentPage,callback:function(a){t.currentPage=a},expression:"currentPage"}})],1),t._v(" "),e("b-col",{staticClass:"my-1",attrs:{md:"6"}},[e("p",{staticClass:"text-muted",staticStyle:{"text-align":"right"}},[t._v(" 显示 "+t._s((t.currentPage-1)*t.perPage+1)+" 至 "+t._s((t.currentPage-1)*t.perPage+t.perPage<=t.totalRows?(t.currentPage-1)*t.perPage+t.perPage:t.totalRows)+" 条 ，总共 "+t._s(t.totalRows)+" 条数据 ")])])],1)],1),t._v(" "),e("b-col",{attrs:{md:"3"}},[e("b-row",{staticClass:"mt-4"},[e("b-col",{staticClass:"my-1 ml-1",attrs:{md:"11"}},[e("h5",{staticClass:"col-form-legend"},[t._v("消息显示控制")])])],1),t._v(" "),e("b-row",[e("b-col",{staticClass:"my-1 ml-1",attrs:{md:"11"}},[e("legend",{staticClass:"col-form-legend"},[t._v("每页显示：")])])],1),t._v(" "),e("b-row",[e("b-col",{staticClass:"my-1 ml-1",attrs:{md:"9"}},[e("b-form-group",[e("b-form-select",{attrs:{options:t.pageOptions},model:{value:t.perPage,callback:function(a){t.perPage=a},expression:"perPage"}})],1)],1)],1),t._v(" "),e("b-row",[e("b-col",{staticClass:"my-1 ml-1",attrs:{md:"11"}},[e("legend",{staticClass:"col-form-legend"},[t._v("按时间排序：")])])],1),t._v(" "),e("b-row",[e("b-col",{staticClass:"my-1 ml-1",attrs:{md:"9"}},[e("b-form-select",{class:{"form-control":!0},attrs:{id:"info",name:"info",plain:!0,options:[{text:"时间由远到近",value:!1},{text:"时间由近到远",value:!0}]},model:{value:t.sortDesc,callback:function(a){t.sortDesc=a},expression:"sortDesc"}})],1)],1),t._v(" "),e("b-row",[e("b-col",{staticClass:"my-1 ml-1",attrs:{md:"12"}},[e("legend",{staticClass:"col-form-legend"},[t._v("模糊搜索：")])])],1),t._v(" "),e("b-row",[e("b-col",{staticClass:"my-1 ml-1",attrs:{md:"9"}},[e("b-form-group",[e("b-input-group",[e("b-form-input",{model:{value:t.filter,callback:function(a){t.filter=a},expression:"filter"}}),t._v(" "),e("b-input-group-button",[e("b-button",{attrs:{variant:"danger",disabled:!t.filter},on:{click:function(a){t.filter=""}}},[t._v("重置")])],1)],1)],1)],1)],1)],1)],1),t._v(" "),e("b-modal",{attrs:{size:"sm","header-bg-variant":t.headerBgVariant,"ok-only":"","ok-title":"关闭",centered:"",title:"消息"},model:{value:t.showModal,callback:function(a){t.showModal=a},expression:"showModal"}},[e("div",{staticClass:"d-block text-center"},[e("h4",[t._v(t._s(t.msg))])])])],1)},o=[],i={render:s,staticRenderFns:o};a.a=i},649:function(t,a,e){"use strict";var s=e(138),o=e.n(s),i=e(514);a.a={name:"message",components:{CMessageTable:i.a},data:function(){return{id:this.$route.fullPath.split("&")[0].split("=")[1],info:{unread:0,important:0,urgent:0,trashed:0},activeName:"first"}},mounted:function(){var t=this;o.a.get("/message/count?status=unread&box=important").then(function(a){t.info.important=a.data.data}),o.a.get("/message/count?status=unread&box=urgent").then(function(a){t.info.urgent=a.data.data}),o.a.get("/message/count?status=unread&box=inbox").then(function(a){t.info.unread=a.data.data})},watch:{$route:function(t,a){this.id=this.$route.fullPath.split("&")[0].split("=")[1]}}}},759:function(t,a,e){"use strict";var s=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"animated fadeIn"},[e("el-tabs",{attrs:{type:"border-card"},model:{value:t.activeName,callback:function(a){t.activeName=a},expression:"activeName"}},[e("el-tab-pane",{attrs:{name:"first"}},[e("span",{attrs:{slot:"label"},slot:"label"},[e("i",{staticClass:"el-icon-message"}),t._v(" 收件箱\n        "),t.info.unread>0?e("b-badge",{attrs:{variant:"primary",pill:""}},[t._v(" "+t._s(t.info.unread))]):t._e()],1)]),t._v(" "),e("el-tab-pane",{attrs:{name:"second"}},[e("span",{attrs:{slot:"label"},slot:"label"},[e("i",{staticClass:"el-icon-info"}),t._v(" 重要信息\n        "),t.info.important>0?e("b-badge",{attrs:{variant:"primary",pill:""}},[t._v(t._s(t.info.important))]):t._e()],1)]),t._v(" "),e("el-tab-pane",{attrs:{name:"fifth"}},[e("span",{attrs:{slot:"label"},slot:"label"},[e("i",{staticClass:"el-icon-message"}),t._v(" 发件箱\n      ")])]),t._v(" "),e("el-tab-pane",{attrs:{name:"third"}},[e("span",{attrs:{slot:"label"},slot:"label"},[e("i",{staticClass:"el-icon-info"}),t._v(" 紧急信息\n        "),t.info.urgent>0?e("b-badge",{attrs:{variant:"danger",pill:""}},[t._v(t._s(t.info.urgent))]):t._e()],1)]),t._v(" "),e("el-tab-pane",{attrs:{label:"垃圾箱",name:"fourth"}},[e("span",{attrs:{slot:"label"},slot:"label"},[e("i",{staticClass:"el-icon-delete"}),t._v(" 已删除\n      ")])]),t._v(" "),e("CMessageTable",{attrs:{mode:t.activeName,info:t.info,id:t.id}})],1)],1)},o=[],i={render:s,staticRenderFns:o};a.a=i}});
//# sourceMappingURL=15.dccd82bbe6fe719b5186.js.map