<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/xhtml"
      xmlns:v-on="http://www.w3.org/1999/xhtml">

<head th:include="/release/common/header :: commonHeader('用户申请查看',true, false)"></head>

<body>
<div id="wrapper">

    <!--/. NAV TOP  -->
    <div th:include="/release/common/navtop :: navtop" class="sidebar-collapse"></div>

    <!-- /. NAV SIDE  -->
    <div th:include="/release/common/navbar :: nav" class="sidebar-collapse"></div>

    <div id="page-wrapper">
        <div class="header">
            <h1 class="page-header">
                先锋系统管理
                <small>新用户申请</small>
            </h1>
            <ol class="breadcrumb">
                <li><a href="/index">主页</a></li>
                <li><a href="#">系统管理</a></li>
                <li class="active">用户申请查看</li>
            </ol>

        </div>
        <div id="page-inner">
            <div class="row">
                <div class="col-md-12">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            用户申请查看
                        </div>
                        <div class="panel-body" id="regPage">
                            <div class="panel-group" id="accordion">
                                <div class="panel panel-info">
                                    <div class="panel-heading">
                                        <h4 class="panel-title">
                                            <span style="cursor: pointer" data-toggle="collapse"
                                                  data-parent="#accordion" href="#collapseOne" class="collapsed">
                                                分类查看
                                            </span>
                                        </h4>
                                    </div>
                                    <div id="collapseOne" class="panel-collapse collapse" style="height: 0;">
                                        <div class="panel-body">
                                            <div class="form-group">
                                                <div class="col-sm-3">
                                                    <button v-on:click="general" id="general" style="width: 100%"
                                                            class="btn btn-primary btn-warning">查看所有申请
                                                    </button>
                                                </div>
                                                <div class="col-sm-3">
                                                    <button v-on:click="active" id="active" style="width: 100%"
                                                            class="btn btn-primary">只查看申请中
                                                    </button>
                                                </div>
                                                <div class="col-sm-3">
                                                    <button v-on:click="viewStatus='1'" id="approved"
                                                            style="width: 100%" class="btn btn-primary btn-success">
                                                        只查看已批准
                                                    </button>
                                                </div>
                                                <div class="col-sm-3">
                                                    <button onclick="declined()" id="declined"
                                                            style="width: 100%" class="btn btn-primary btn-danger">
                                                        只查看已拒绝
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="panel panel-default">
                                <div class="panel-heading">
                                    <h4 class="panel-title">
                                        申请数据
                                    </h4>
                                </div>
                                <div class="panel-body">
                                    <table class="table table-striped table-bordered table-hover" id="userReg"></table>
                                </div>
                            </div>
                        </div>

                    </div>
                    <!--End Advanced Tables -->
                </div>
            </div>
            <div id=footerPlaceholder">
                <div th:include="/release/common/footer :: copy" id="copyright"></div>
            </div>
        </div>
        <!-- /. PAGE INNER  -->
    </div>
    <!-- /. PAGE WRAPPER  -->
</div>
<!-- /. WRAPPER  -->
<div th:include="/release/common/js :: load_js(true , false, false)"></div>
<!--<script src="/static/scripts/admin/system/manageRequest.js"></script>-->
<script>
    const regVue = new Vue({
        el: '#regPage',
        data: {
            regUser: {
                info: "",
                lastName: "",
                firstName: "",
                email: "",
                password: "",
                qq: "",
                tel: "",
                birthday: "",
                gender: ""
            },
            userRegTable: null,
            viewStatus: ""
        },
        mounted: function () {
            this.userRegTable = $("#userReg").DataTable({

                "language": {
                    "aria": {
                        "sortAscending": ": activate to sort column ascending",
                        "sortDescending": ": activate to sort column descending"
                    },
                    "emptyTable": "没有数据！",
                    "info": "显示 _START_ 至 _END_ 条 ，总共_TOTAL_ 条数据",
                    "infoEmpty": "没有发现记录！",
                    "infoFiltered": "(从_MAX_条记录中搜索)",
                    "lengthMenu": "显示: _MENU_",
                    "search": "搜索:",
                    "zeroRecords": "没有找到匹配的记录！",
                    "paginate": {
                        "previous": "上一页",
                        "next": "下一页",
                        "last": "尾页",
                        "first": "首页"
                    }
                },
                "pagingType": "full_numbers",
                "lengthMenu": [
                    [5, 10],
                    [5, 10]
                ],
                pageLength: 10,
                processing: true,
                serverSide: true,

                ajax: {
                    url: basePath + "/request/user/list",
                    data: {
                        viewStatus: this.viewStatus
                    }
                },
                columns: [
                    {"data": "id", "title": "序列号", "width": "100px"},
                    {"data": "userId", "title": "分配ID"},
                    {
                        "data": "userJson", "title": "姓, 名", "createdCell": function (nTd, rowData) {
                        let user = JSON.parse(rowData);
                        $(nTd).html(user.lastName + ", " + user.firstName);
                    }
                    },
                    {"data": "createTime", "title": "申请时间"},
                    {
                        "data": "status", "title": "申请状态", "createdCell": function (nTd, rowData) {
                        if (rowData === "0") $(nTd).html('<p style="line-height: 1.42857143; padding-top: 0; color:blue; ">申请中</p>');
                        else if (rowData === "1") $(nTd).html('<p style="line-height: 1.42857143; padding-top: 0;color:green; ">已批准</p>');
                        else if (rowData === "-1") $(nTd).html('<p style="line-height: 1.42857143; padding-top: 0;color:red; ">已拒绝</p>');
                    }
                    },
                    {
                        "data": null, "title": "操作", "createdCell": function (nTd) {
                        $(nTd).html('<button class="btn btn-edit btn-warning">查看详情</button>');
                    }, "width": "100px"
                    }
                ],
                "columnDefs": [{
                    orderable: false,
                    targets: [5]
                }, {
                    "defaultContent": "",
                    "targets": "_all"
                }]
            });
        },
        methods: {
            general: function () {
                this.viewStatus = "";
                this.userRegTable.ajax.reload(null, true);

            },
            active: function () {
                console.log(this.viewStatus);
                this.viewStatus = "0";
                this.userRegTable.ajax.reload(null, true);
                this.userRegTable.draw();
            }
        }
    });

    function declined(){
        regVue.$data.viewStatus = "-1";

    }

</script>
</body>
</html>
