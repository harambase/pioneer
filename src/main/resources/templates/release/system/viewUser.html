<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head th:include="/release/common/header :: commonHeader('用户查看',true, false)"></head>

<body>
<div id="wrapper">

    <!--/. NAV TOP  -->
    <div th:include="/release/common/navtop :: navtop" class="sidebar-collapse"></div>

    <!-- /. NAV SIDE  -->
    <div th:include="/release/common/navbar :: nav" class="sidebar-collapse"></div>

    <div id="page-wrapper">
        <div class="header">
            <h1 class="page-header">
                先锋系统管理
                <small>用户查看</small>
            </h1>
            <ol class="breadcrumb">
                <li><a href="/index">主页</a></li>
                <li><a href="#">系统管理</a></li>
                <li class="active">用户查看</li>
            </ol>

        </div>
        <div id="page-inner">
            <div class="row" id="userPage">
                <div class="col-xs-12">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <div class="card-title">
                                <div class="title">系统用户列表</div>
                            </div>
                        </div>
                        <div class="panel-body">
                            <table class="table table-striped table-bordered table-hover" id="userTable"></table>
                        </div>
                    </div>
                </div>
            </div>
            <div id=footerPlaceholder">
                <div th:include="/release/common/footer :: copy" id="copyright"></div>
            </div>
        </div>
        <!-- /. PAGE INNER  -->
    </div>
    <!-- /. PAGE WRAPPER  -->
</div>
<!-- /. WRAPPER  -->
<div th:include="/release/common/js :: load_js(true , false, false)"></div>

<!--<script src="/static/scripts/admin/system/viewUser.js"></script>-->
<script>
    let userTable;
    let userVue = new Vue({
        el: '#userPage',
        data:{
            userList:[],
            user:{
                userId: "",
                createTime: "",
                updateTime:"",
                status:"",
                userInfo:"",
                roleId:"",
                type:"",
                info: "",
                lastName: "",
                firstName: "",
                email: "",
                password: "",
                qq: "",
                tel: "",
                birthday: "",
                gender: "",
                comment: "",
                profile:""
            },
            userType:[],
            userRole:[]
        },
        mounted: function () {
            laydate.render({
                elem: '#birthday',
                theme: '#393D49',
                showBottom: false,
                done: (value) => {
                    this.user.birthday = value
                }
            });
        },
    });
    function deleteUser(userId){
        Showbo.Msg.confirm("确认删除该用户？", function () {
            if ($(".btnfocus").val() !== "取消") {
                axios.delete("/user/" + userId).then(function (response) {
                    if (response.data.code === 2001)
                        Showbo.Msg.alert("删除成功!", function () {
                            userTable.draw();
                        });
                    else
                        Showbo.Msg.alert(response.data.msg, function () {
                        });
                });
            }
        });
    }
    $(function () {
        userTable = $("#userTable").DataTable({
            "language": {
                "aria": {
                    "sortAscending": ": activate to sort column ascending",
                    "sortDescending": ": activate to sort column descending"
                },
                "emptyTable": "没有数据！",
                "info": "显示 _START_ 至 _END_ 条 ，总共_TOTAL_ 条数据",
                "infoEmpty": "没有发现记录！",
                "infoFiltered": "(从_MAX_条记录中搜索)",
                "lengthMenu": "显示: _MENU_",
                "search": "搜索:",
                "zeroRecords": "没有找到匹配的记录！",
                "paginate": {
                    "previous": "上一页",
                    "next": "下一页",
                    "last": "尾页",
                    "first": "首页"
                }
            },
            "pagingType": "full_numbers",
            "lengthMenu": [
                [5, 10, 50],
                [5, 10, 50]
            ],
            pageLength: 10,
            processing: true,
            serverSide: true,

            ajax: {
                url: basePath + "/user",
            },
            columns: [
                {  //行号
                    "data": null, "title": "ROW", "render": function (data, type, row, meta) {
                        return meta.settings._iDisplayStart + meta.row + 1;
                    }
                },
                {"data": "userId", "title": "用户ID"},
                {"data": "username", "title": "用户名"},
                {"data": "lastName", "title": "姓"},
                {"data": "firstName", "title": "名"},
                {"data": "type", "title": "账户类型"},
                {
                    "data": "status", "title": "状态", "createdCell": function (nTd, rowData) {
                        if (rowData === "1") $(nTd).html('<p style="line-height: 1.42857143; padding-top: 0; color:green;">已启用</p>');
                        else if (rowData === "0") $(nTd).html('<p style="line-height: 1.42857143; padding-top: 0; color:red; ">已禁用</p>')
                        userVue.$data.userList.push(rowData);
                    }
                },
                {"data": "updateTime", "title": "更新时间"},
                {
                    "data": null, "title": "操作", "createdCell": function (nTd, rowData, row, col) {
                        $(nTd).html('<button class="btn btn-info" onclick="deleteUser(\'' + rowData.userId + '\')">删除用户</button>' +
                            '<button class="btn btn-edit">编辑用户</button>');
                    }, "width": "180px"
                }
            ],
            "columnDefs": [{
                orderable: false,
                targets: [8]
            }, {
                "defaultContent": "",
                "targets": "_all"
            }]

        });
    });
</script>
</body>
</html>
